<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Tumor Classifier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .container {
            max-width: 800px;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem; /* rounded-lg */
            font-weight: 600; /* font-semibold */
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: #4338ca; /* indigo-700 */
        }
        .file-input-label {
            display: inline-block;
            background-color: #e0e7ff; /* indigo-100 */
            color: #4f46e5; /* indigo-600 */
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            border: 1px solid #a5b4fc; /* indigo-300 */
            transition: background-color 0.2s, border-color 0.2s;
        }
        .file-input-label:hover {
            background-color: #c7d2fe; /* indigo-200 */
            border-color: #818cf8; /* indigo-400 */
        }
        .hidden-input {
            display: none;
        }
        .result-box {
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1.5rem;
            background-color: #f9fafb; /* gray-50 */
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #4f46e5;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 0.5rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="container card p-8 w-full">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Brain Tumor Classification</h1>

        <form id="uploadForm" enctype="multipart/form-data" class="space-y-6">
            <div class="flex flex-col items-center space-y-4">
                <label for="imageUpload" class="file-input-label">
                    Choose Image
                </label>
                <input type="file" id="imageUpload" name="image" accept="image/*" class="hidden-input">
                <span id="fileName" class="text-gray-600">No file chosen</span>
            </div>

            <div class="text-center">
                <button type="submit" class="btn-primary">
                    Predict
                    <span id="loadingSpinner" class="loading-spinner hidden"></span>
                </button>
            </div>
        </form>

        <div id="result" class="result-box mt-8 hidden">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Prediction Result:</h2>
            <div id="predictedClass" class="text-lg font-medium text-gray-900 mb-2"></div>
            <div id="probabilities" class="text-gray-700"></div>
            <div class="mt-4">
                <img id="uploadedImagePreview" src="#" alt="Uploaded Image" class="max-w-full h-auto rounded-md shadow-md mx-auto" style="max-height: 200px; object-fit: contain; display: none;">
            </div>
        </div>

        <div id="error" class="result-box bg-red-100 border-red-400 text-red-700 hidden">
            <h2 class="text-xl font-semibold mb-4">Error:</h2>
            <div id="errorMessage" class="text-lg"></div>
        </div>
    </div>

    <script>
        document.getElementById('imageUpload').addEventListener('change', function() {
            const fileNameSpan = document.getElementById('fileName');
            const uploadedImagePreview = document.getElementById('uploadedImagePreview');
            if (this.files && this.files[0]) {
                fileNameSpan.textContent = this.files[0].name;

                // Display image preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImagePreview.src = e.target.result;
                    uploadedImagePreview.style.display = 'block';
                };
                reader.readAsDataURL(this.files[0]);
            } else {
                fileNameSpan.textContent = 'No file chosen';
                uploadedImagePreview.style.display = 'none';
                uploadedImagePreview.src = '#';
            }
        });

        document.getElementById('uploadForm').addEventListener('submit', async function(event) {
            event.preventDefault(); // Prevent default form submission

            const fileInput = document.getElementById('imageUpload');
            const resultDiv = document.getElementById('result');
            const errorDiv = document.getElementById('error');
            const predictedClassDiv = document.getElementById('predictedClass');
            const probabilitiesDiv = document.getElementById('probabilities');
            const errorMessageDiv = document.getElementById('errorMessage');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const predictButton = document.querySelector('#uploadForm button[type="submit"]');

            // Hide previous results/errors
            resultDiv.classList.add('hidden');
            errorDiv.classList.add('hidden');
            predictedClassDiv.textContent = '';
            probabilitiesDiv.textContent = '';
            errorMessageDiv.textContent = '';

            // Show loading spinner and disable button
            loadingSpinner.classList.remove('hidden');
            predictButton.disabled = true;

            if (fileInput.files.length === 0) {
                errorMessageDiv.textContent = 'Please select an image file.';
                errorDiv.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
                predictButton.disabled = false;
                return;
            }

            const formData = new FormData();
            formData.append('image', fileInput.files[0]);

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    predictedClassDiv.textContent = `Predicted Class: ${data.prediction}`;
                    // Format probabilities nicely
                    const probText = Object.entries(data.probabilities).map(([key, value]) => {
                        return `${key}: ${(value * 100).toFixed(2)}%`;
                    }).join(', ');
                    probabilitiesDiv.textContent = `Probabilities: ${probText}`;
                    resultDiv.classList.remove('hidden');
                } else {
                    errorMessageDiv.textContent = data.error || 'Unknown error occurred.';
                    errorDiv.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Fetch error:', error);
                errorMessageDiv.textContent = `Network error or server unreachable: ${error.message}`;
                errorDiv.classList.remove('hidden');
            } finally {
                loadingSpinner.classList.add('hidden');
                predictButton.disabled = false;
            }
        });
    </script>
</body>
</html>
